{% extends 'Design311WebsiteBundle::layout.html.twig' %}

{% block content %}

<div id="map" class="map"></div>

<div class="container">
	<div class="one-third">
		{% if app.user == dinner.user %}
		<p><a href="{{ path('design311website_dinners_edit', {'permalink': dinner.permalink}) }}" class="button button-orange"><i class="sprite edit white"></i>Dinner bewerken</a></p>
		{% endif %}
		<div class="widget">
			<h3>Algemene informatie</h3>
			<ul>
				<li>Organisator: <a href="{{ path('design311website_profile_view', {'username': dinner.user.username}) }}">{{dinner.user.displayName}}</a></li>
				<li>Maximum aantal personen: {{dinner.maxInvitees}}</li>
				<li>Prijs: â‚¬{{dinner.price}}</li>
				<li>Datum: {{dinner.date | date("m/d/Y") }}</li>
				<li>Tijdstip: {{dinner.date | date("G:i") }}</li>
			</ul>
		</div>
		<div class="widget">
			<h3>Deelnemers</h3>
			{% if dinner.participants|length > 0 %}
			<ul>
			{% for participant in dinner.participants %}
			    <li>{{participant.user.displayName}}</li>
			{% endfor %}
			</ul>
			{% else %}
			    <p>Momenteel zijn er nog geen deelnemers.</p>
			{% endif %}
			{% if app.user == dinner.user %}
				<p><a href="{{ path('design311website_dinners_invite', {'permalink': dinner.permalink}) }}">Deelnemers uitnodigen</a></p>
			{% endif %}
		</div>
		{% if app.user == dinner.user %}
		<div class="widget">
			<h3>Verzoeken</h3>
			{% if dinner.participantRequests|length > 0 %}
			<ul>
			{% for request in dinner.participantRequests %}
			    <li>{{request.user.displayName}}</li>
			{% endfor %}
			</ul>
			{% else %}
			    <p>Momenteel zijn er geen deelname-verzoeken.</p>
			{% endif %}
		</div>
		{% endif %}
	</div>
	<div class="two-third main">
		<h1>{{dinner.title}}</h1>
		{{dinner.menu|markdown}}

		{% if app.user %}
			{% if app.user != dinner.user and app.user not in dinner.participants and app.user not in dinner.participantRequests %}
			<h2>Deelnemen</h2>
			<p>Krijg je al spontaan honger? Stel jezelf even kort voor aan de organisator.</p>
			{{ form(form) }}
			{% endif %}
		{% else %}
		    <h2>Krijg je al spontaan honger?</h2>
		    <p><a href="{{ path('design311website_login') }}">Meld je aan om deel te nemen</a></p>
		{% endif %}

		<div class="dinnerphotos">
			{% for photo in dinner.photos %}
				<img src="{{ asset(photo.webPath)}}" alt="{{photo.title}}">
			{% endfor %}
		</div>
	</div>
</div>

{% endblock %}

{% block footer %}
    <script src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<script src="{{ asset('bundles/design311website/js/jquery-ui/jquery-ui-1.10.4.slider.min.js') }}"></script>
	<link rel="stylesheet" href="{{ asset('bundles/design311website/js/jquery-ui/jquery-ui-1.10.4.slider.min.css') }}">
	<script type="text/javascript">

		$(function(){
			var map;
			var marker;
			var geocoder = new google.maps.Geocoder();
			var startMarker;

			var dinnerCoords = new google.maps.LatLng({{dinner.address.lat}}, {{dinner.address.lng}});

			map = new google.maps.Map(document.getElementById('map'), {
				mapTypeId: google.maps.MapTypeId.ROADMAP,
				streetViewControl: false,
				mapTypeControl: false,
				scrollwheel: false,
				zoom:16,
				center:dinnerCoords
			});
			
			var marker = new google.maps.Marker({
				map: map,
				position: dinnerCoords,
				icon: "{{ asset('bundles/design311website/img/marker.png')}}"
			});

			if(navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(function(position) {
					var currentPosition = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
					displayRoute(currentPosition);
				});
			}

			function displayRoute(start){
				var directionsDisplay = new google.maps.DirectionsRenderer({suppressInfoWindows:true, suppressMarkers: true});
				var directionsService = new google.maps.DirectionsService();
				directionsDisplay.setMap(map);

				var request = {
					origin:start,
					destination:dinnerCoords,
					travelMode: google.maps.TravelMode.DRIVING
				};
				directionsService.route(request, function(response, status) {
					if (status == google.maps.DirectionsStatus.OK) {
						directionsDisplay.setDirections(response);
						startmarker = new google.maps.Marker({
							map: map,
							position: start,
							icon: "{{ asset('bundles/design311website/img/home-marker.png')}}"
						});
					}
				});
			}
		});
	</script>
{% endblock %}