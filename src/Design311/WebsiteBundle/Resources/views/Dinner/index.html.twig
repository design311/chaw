{% extends 'Design311WebsiteBundle::layout.html.twig' %}

{% block content %}

<div id="map" class="map"></div>

<div class="content">
	<div class="container">
		<table id="dinners">
			<tr>
				<th>Datum</th>
				<th>Titel</th>
				<th>Plaats</th>
				<th>Prijs</th>
			</tr>
			<tbody>
			{% for dinner in dinners %}
			<tr>
				<td>{{dinner.date|date('d-m-Y')}}</td>
				<td>{{dinner.title}}</td>
				<td>{{dinner.address.city}}</td>
				<td>{{dinner.price}}</td>
			</tr>
			{% endfor %}
			</tbody>
		</table>
	</div>
</div>
{% endblock %}

{% block footer %}
    <script src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<script src="{{ asset('bundles/design311website/js/maps.markerclusterer.js') }}"></script>
	<script type="text/javascript">
		var geocoder;
		var map;
		var markers = [];
		var locations = {{ locations|json_encode|raw }};

		google.maps.event.addDomListener(window, 'load', function(){

			var center = new google.maps.LatLng(51.2167, 4.4000);

			map = new google.maps.Map(document.getElementById('map'), {
				zoom: 9,
				center: center,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			});
			
			var latlngbounds = new google.maps.LatLngBounds();

			$.each(locations, function(i, item){

					var coords = new google.maps.LatLng(item[0], item[1]);
					
					var marker = new google.maps.Marker({
							map: map,
							position: coords,
							dinnerId: i
					});
					markers.push(marker);
					latlngbounds.extend(coords);
				
			})
			var markerCluster = new MarkerClusterer(map, markers);
			map.setCenter(latlngbounds.getCenter());
			map.fitBounds(latlngbounds);

			/*google.maps.event.addListener(map, 'bounds_changed', function() {
				var bounds = map.getBounds();
				for (var i=0; i<markers.length; i++){
					if( bounds.contains(markers[i].getPosition()) ){
						var tbody = $('#dinners tbody');
						tbody.empty();
						markers[i].dinnerId
					}
				}
			});*/
		});



	</script>
{% endblock %}