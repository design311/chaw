{% extends 'Design311WebsiteBundle::layout.html.twig' %}

{% block content %}
	{{ form(form) }}
{% endblock %}

{% block footer %}
    <script>
    	var photoHolder;

		// setup an "add a photo" link
		var addPhotoLink = $('<a href="#" class="add_photo_link">Add a photo</a>');
		var addIngredientLink = $('<a href="#" class="add_photo_link">Add an ingredient</a>');

		jQuery(document).ready(function() {
		    // Get the ul that holds the collection of photos
		    photoHolder = $('div#recipe_photos');
		    ingredientHolder = $('div#recipe_ingredients');

		    // add the "add a photo" anchor and li to the photos ul
		    photoHolder.append(addPhotoLink);
		    ingredientHolder.append(addIngredientLink);

		    // count the current form inputs we have (e.g. 2), use that as the new
		    // index when inserting a new item (e.g. 2)
		    photoHolder.data('index', photoHolder.find(':input').length);
		    ingredientHolder.data('index', ingredientHolder.find(':input').length);

		    addPhotoLink.on('click', function(e) {
		        // prevent the link from creating a "#" on the URL
		        e.preventDefault();

		        // add a new photo form (see next code block)
		        addInput(photoHolder, addPhotoLink);
		    });

		    addIngredientLink.on('click', function(e) {
		        // prevent the link from creating a "#" on the URL
		        e.preventDefault();

		        // add a new photo form (see next code block)
		        addInput(ingredientHolder, addIngredientLink);
		    });
		});

		function addInput(holder, link) {
		    // Get the data-prototype explained earlier
		    var prototype = holder.data('prototype');

		    // get the new index
		    var index = holder.data('index');

		    // Replace '__name__' in the prototype's HTML to
		    // instead be a number based on how many items we have
		    var newForm = prototype.replace(/__name__/g, index);

		    // increase the index with one for the next item
		    holder.data('index', index + 1);

		    // Display the form in the page in an li, before the "Add a photo" link li
		    var newFormLi = $('<li></li>').append(newForm);
		    link.before(newFormLi);
		}
    </script>
{% endblock %}