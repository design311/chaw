{% extends 'Design311WebsiteBundle::layout.html.twig' %}

{% block bodyclass %}receptenindex{% endblock %}

{% block content %}
	<div class="newestrecipes">
		<div class="container">
			<h1 class="averia">Nieuwste recepten</h1>
			<div class="flexslider">
				<ul class="slides">
				{% for recipe in newestrecipes %}
					<li>
					{% if recipe.photos[0] is defined %}
						<div class="imagecontainer"><img src="{{ asset(recipe.photos[0].webPath) }}" alt="{{ recipe.photos[0].title }}" /></div>
					{% endif %}
						<div class="caption">
							<a href="#">{{ recipe.title }}</a>
						</div>
					</li>
				{% endfor %}
				</ul>
			</div>
		</div>
	</div>
	<div class="recipecategories">	
		<div class="container">
			<div class="one-third sidebar">
				<p><a href="{{ path('design311website_recepten_add') }}" class="button addrecipe">Recept toevoegen</a></p>
				<p><a href="{{ path('design311website_recepten_shoppinglist') }}" class="button shoppinglist">Winkellijstje bekijken (<span class="shoppinglistcount">{{app.user.shoppinglist|length}}</span>)</a></p>
				<p><h3>Recepten zoeken op ingredient</h3></p>
				<p>FORM Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusamus, quidem, omnis sapiente autem quaerat pariatur dolor fugit est assumenda in ipsam quis optio tenetur. Odit culpa soluta officiis odio provident!</p>
			</div>
			<div class="two-third main">
				{% for key, category in categories %}
				    <div class="category{% if loop.index is even %} even{% endif %}">
				    	{% set lastrecipe = category.recipe | last %}
				    	<div class="orangehover inversed">
				    		<img src="{{ asset(lastrecipe.photos[0].webPath) }}" alt="{{ lastrecipe.photos[0].title }}" />
				    		<div class="hover">
				    			<h2 class="text">{{category.name}}</h2>
				    		</div>
				    	</div>
				    </div>
				{% endfor %}
			</div>
		</div>
	</div>

	<!-- {% for recipe in recipes %}
	<div>
		{{recipe.title}}
		{% for photo in recipe.photos %}
			<img src="{{ asset(photo.webPath) }}" width="500">
		{% endfor %}
		<ul>
		{% for recipeingredient in recipe.recipeingredients %}
			<li>{{recipeingredient.amount}} {{recipeingredient.ingredient}}</li>
		{% endfor %}
		</ul>
		{{recipe.category}}
	
		{% if app.user %}
			<p><a href="{{path('design311website_recepten_like', {'recipeId': recipe.id})}}" class="like-button">
				{% if app.user in recipe.likedBy %}
				dislike this recipe
				{% else %}
				like this recipe
				{% endif %}
			</a></p>
			<p><a href="{{path('design311website_recepten_save', {'recipeId': recipe.id})}}" class="save-button">
				{% if app.user in recipe.likedBy %}
				remove this recipe from saves
				{% else %}
				save this recipe
				{% endif %}
			</a></p>
			<p><a href="{{path('design311website_recepten_shop', {'recipeId': recipe.id})}}" class="shop-button">
				{% if app.user in recipe.shoppinglistFrom %}
				remove this recipe from shoppinglist
				{% else %}
				add recipe to shoppinglist
				{% endif %}
			</a></p>
		{% else %}
		    <p><a href="{{ path('design311website_login') }}">Login om dit recept te liken</a></p>
		{% endif %}
	
		{% if app.user == recipe.user %}
		    <p><a href="{{ path('design311website_recepten_edit', {'recipeId': recipe.id}) }}">edit</a></p>
		{% endif %}
	</div>
	<hr>
	{% endfor %} -->

{% endblock %}

{% block head %}
		<link rel="stylesheet" href="{{ asset('bundles/design311website/js/flexslider/flexslider.css') }}">
{% endblock %}

{% block footer %}
	<script src="{{ asset('bundles/design311website/js/flexslider/jquery.flexslider-min.js') }}"></script>
	<script>
		$(function(){
			$('.like-button').click(function(){
				var link = $(this);
				//TODO use different attribute
				//TODO add loader gif for slow json
				$.getJSON( $(this).attr('href'), function( data ) {
					if (data.status === 1) {
						link.text('dislike this recipe');
					}
					else{
						link.text('like this recipe');
					}
				});

				return false;
			})
			$('.save-button').click(function(){
				var link = $(this);
				//TODO add loader gif for slow json
				$.getJSON( $(this).attr('href'), function( data ) {
					if (data.status === 1) {
						link.text('remove this recipe from saves');
					}
					else{
						link.text('save this recipe');
					}
				});

				return false;
			})
			$('.shop-button').click(function(){
				var link = $(this);
				//TODO add loader gif for slow json
				$.getJSON( $(this).attr('href'), function( data ) {
					if (data.status === 1) {
						link.text('remove this recipe from shoppinglist');
					}
					else{
						link.text('add recipe to shoppinglist');
					}
					$('.shoppinglistcount').text(data.shoppinglistcount);
				});

				return false;
			})
		})
	</script>
{% endblock %}